# aoe2scraper

A small Python script for querying the Age of Empires II (AOE2 / Age II) public stats API and downloading match replays.

## What it does

- Download a match replay ZIP by `match_id` and optionally unzip it.
- Fetch match details, full player stats, a player's recent match list, campaign stats, and leaderboard data.
- Exposes a small set of helper functions you can call from your own scripts.

## Requirements

- Python 3.8+ (tested with standard CPython)
- `requests`

Install deps:

```bash
python -m pip install requests
```

## Quick start

Run the script directly to hit the default endpoints and print responses:

```bash
python fetch_replay.py
```

Download a replay ZIP using the defaults (see `defaults` in the script):

```bash
python -c "from fetch_replay import fetch_endpoint, save_replay, defaults; resp = fetch_endpoint('replay', match_id=defaults['match_id']); save_replay(resp)"
```

## Configuration

Edit the `defaults` dict in `fetch_replay.py` to change:

- `destination_folder`: where replay ZIPs are saved (default: `replays`)
- `game`: game key (default: `age2`)
- `profile_id`: used for sample calls (default: Hera's profile ID)
- `match_id`: used for sample calls (default: a match from Hera's profile)
- `unzip`: whether to unzip downloaded replay ZIPs (default: `True`)
- `remove_zip`: whether to delete the ZIP after extraction (default: `True`)
- `headers`: default headers sent with API requests

## Core functions

- `save_replay(response, destination_folder=..., unzip=..., remove_zip=...)`
- `fetch_player_match_list(profile_id, game=..., sortColumn='dateTime', sort_direction='DESC', match_type='3')`
- `fetch_leaderboard(region='7', match_type='3', console_match_type=15, search_player='', page=1, count=100, sort_column='rank', sort_direction='ASC')`
- `fetch_endpoint(endpoint_name, profile_id=..., match_id=..., headers=..., data=None)`
- `run_endpoint_tests()`

## Endpoints

The script currently supports these endpoint keys (see `endpoints` in `fetch_replay.py`):

- `replay`
- `match_details`
- `player_stats`
- `player_match_list`
- `player_campaign_stats`
- `leaderboard`

## Notes and caveats

- The headers/payloads are based on requests captured from the official Age of Empires website and may change.
- `fetch_player_match_list` only returns the most recent matches; paging behavior appears limited to page 1.
- `match_type` values are partially documented in the comments in `fetch_replay.py` and may require further verification.
- The replay download endpoint requires both `matchId` and `profileId` query parameters, even though the `profileId` value does not appear to matter.

## Legal and usage

This is an unofficial script and is not affiliated with or endorsed by Microsoft or the Age of Empires team. Use responsibly and respect the terms of service of any API you call. It is unclear to what extent Microsoft will allow scraping of their API. Use at your own risk.

## AI Disclosure

This readme was auto-generated by AI. Some code was auto-filled using either Copilot or Codex, though all was reviewed by the author.
